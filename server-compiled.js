(()=>{var e={860:e=>{"use strict";e.exports=require("express")},470:e=>{"use strict";e.exports=require("fs-extra")},13:e=>{"use strict";e.exports=require("mongodb")},738:e=>{"use strict";e.exports=require("multer")},109:e=>{"use strict";e.exports=require("sanitize-html")},441:e=>{"use strict";e.exports=require("sharp")},17:e=>{"use strict";e.exports=require("path")}},t={};function s(o){var n=t[o];if(void 0!==n)return n.exports;var i=t[o]={exports:{}};return e[o](i,i.exports,s),i.exports}(()=>{const{MongoClient:e,ObjectId:t}=s(13),o=s(860),n=s(738)(),i=s(109),a=(s(470),s(441));let r;const c=s(17),l=o();l.set("view engine","ejs"),l.set("views","./views"),l.use(o.static("public")),l.use(o.json()),l.use(o.urlencoded({extended:!1})),l.get("/",(async(e,t)=>{const s=await r.collection("animals").find().toArray();console.log(s),t.render("home",{allAnimals:s})})),l.use((function(e,t,s){t.set("WWW-Authenticate","Basic realm='Our MERN App"),"Basic YWRtaW46YWRtaW4="==e.headers.authorization?s():(console.log(e.headers.authorization),t.status(401).send("Try Again"))})),l.get("/admin",((e,t)=>{t.render("admin")})),l.get("/api/animals",(async(e,t)=>{const s=await r.collection("animals").find().toArray();t.json(s)})),l.post("/create-animal",n.single("photo"),(function(e,t,s){"string"!=typeof e.body.name&&(e.body.name=""),"string"!=typeof e.body.species&&(e.body.species=""),"string"!=typeof e.body._id&&(e.body._id=""),e.cleanData={name:i(e.body.name.trim(),{allowedTags:[],allowedAttributes:{}}),species:i(e.body.species.trim(),{allowedTags:[],allowedAttributes:{}})},s()}),(async(e,s)=>{if(e.file){const t=`${Date.now()}.jpg`;await a(e.file.buffer).resize(844,456).jpeg({quality:60}).toFile(c.join("public","uploaded-photos",t)),e.cleanData.photo=t}console.log(e.body);const o=await r.collection("animals").insertOne(e.cleanData),n=await r.collection("animals").findOne({_id:new t(o.insertedId)});s.send(n)})),async function(){const t=new e("mongodb+srv://user:AMBLUEABBADEEABBADAAE@cluster0.oxnwe.mongodb.net/AbbaDeeAbbaDae?&authSource=admin");await t.connect(),r=t.db(),l.listen(4230,(()=>{console.log("\nThe server is running at port 42300\nPress CTRL + C to end the server")}))}()})()})();